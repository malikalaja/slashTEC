def branchName     = params.BranchName ?: "main"
def gitUrl         = "https://github.com/malikalaja/slashTEC.git"
def gitUrlCode     = "https://github.com/malikalaja/slashTEC.git"
def serviceName    = "airport-service"
def EnvName        = "preprod"
def registryId     = "727245885999" // AWS ECR registry ID
def awsRegion      = "ap-south-1"
def ecrUrl         = "727245885999.dkr.ecr.ap-south-1.amazonaws.com"
def dockerfile     = "docker/Dockerfile"
def imageTag       = "${EnvName}-${BUILD_NUMBER}"
def ARGOCD_URL     = "https://argocd-preprod.login.foodics.online" // URL of the ArgoCD server

// AppConfig Params
def applicationName = "airport-services"
def envName = "preprod"
def configName = "preprod"
// Fix: Use string concatenation, not arithmetic
def clientId = "${applicationName}-${envName}"
def latestTagValue = params.Tag
def namespace = "preprod"
def helmDir = "helm-unified"
def slashtecDir = "."

node {
  withCredentials([string(credentialsId: 'foodics-slack-online-deployments', variable: 'SLACK_WEBHOOK')]) {
    try {
      notifyBuild('STARTED')
      stage('cleanup') {
        cleanWs()
      }
      stage ("Get the app code") {
        checkout([$class: 'GitSCM', branches: [[name: "${branchName}"]] , extensions: [], userRemoteConfigs: [[ url: "${gitUrlCode}"]]])
        sh("cp ${slashtecDir}/${dockerfile} Dockerfile")
        sh("cp -r ${slashtecDir}/interview-test/*.jar .")
      }
      stage("Get the env variables from App") {
        sh "aws appconfig get-configuration --application ${applicationName} --environment ${envName} --configuration ${configName} --client-id ${clientId} .env --region ${awsRegion}"
      }
      stage('login to ecr') {
        sh("aws ecr get-login-password --region ${awsRegion} | docker login --username AWS --password-stdin ${ecrUrl}")
      }
      stage('Build Docker Image') {
        sh("docker build -t ${ecrUrl}/${serviceName}:${imageTag} -f Dockerfile .")
      }
      stage('Push Docker Image To ECR') {
        sh("docker push ${ecrUrl}/${serviceName}:${imageTag}")
      }
      stage('Clean docker images') {
        sh("docker rmi -f ${ecrUrl}/${serviceName}:${imageTag} || :")
      }
      stage ("Deploy ${serviceName} to ${EnvName} Environment") {
        sh ("cd ${helmDir}; pathEnv=\".airportService.image.tag\" valueEnv=\"${imageTag}\" yq 'eval(strenv(pathEnv)) = strenv(valueEnv)' -i values.yaml ; cat values.yaml")
        sh ("cd ${helmDir}; git pull ; git add values.yaml; git commit -m 'update airport-service image tag' ;git push ${gitUrl}")
      }

      // The ArgoCD stages remain commented, as in your code

    } catch (org.jenkinsci.plugins.workflow.steps.FlowInterruptedException e) {
      currentBuild.result = "ABORTED"
      echo "Build aborted: ${e}"
    } catch (Exception e) {
      currentBuild.result = "FAILED"
      echo "Exception type: ${e.getClass().getName()}"
      echo "Exception message: ${e.message ?: 'No message'}"
      throw e
    } finally {
      notifyBuild(currentBuild.result)
    }
  }
}